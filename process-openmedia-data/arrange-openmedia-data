#!/usr/bin/env bash

#
# Run the `cro-openmedia-arrange` command.
#
# Required environment variables:
# $ANNOVA: The path to exported OpenMedia files
#

if [[ ${ANNOVA} -eq 0 ]];
    echo "Variable ANNOVA is not set";
    then exit ;
fi

# Set varibles for directory path construction.
YEAR=`date +%Y` # The current year.
WEEK=`date +%V` # The current week (number).

echo "The year/week path is ${YEAR}/${WEEK}."

# Update programs to latest version.
echo "Pulling czech-radio/openmedia."
git pull --rebase origin main

echo "Activating virtual environment."
source /root/.venv/bin/activate

echo "Updating czech-radio/openmedia."
pip install -U /root/bin/openmedia

# Run the programs.
echo "Runing cro-openmedia-arrange command."
cro-openmedia-arrange --input ${ANNOVA}

# Clean up and exit.
echo "Deactivating virtual environment."
deactivate

exit 0